<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Replay Links - House of Voi</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-link {
            display: block;
            padding: 10px;
            margin: 10px 0;
            background: #333;
            border-radius: 8px;
            text-decoration: none;
            color: #10b981;
            border: 1px solid #444;
        }
        .test-link:hover {
            background: #444;
            border-color: #10b981;
        }
        .test-description {
            font-size: 14px;
            color: #ccc;
            margin-top: 5px;
        }
        .generate-button {
            background: #10b981;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .generate-button:hover {
            background: #059669;
        }
        #output {
            background: #222;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #444;
        }
        .copy-btn {
            background: #6b7280;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <h1>House of Voi - Replay Link Tester</h1>
    
    <h2>Test Scenarios</h2>
    <p>Generate replay links with different outcomes to test the implementation:</p>
    
    <button class="generate-button" onclick="generateBigWin()">Generate Big Win (500 VOI)</button>
    <button class="generate-button" onclick="generateSmallWin()">Generate Small Win (25 VOI)</button>
    <button class="generate-button" onclick="generateLoss()">Generate Loss</button>
    <button class="generate-button" onclick="generateJackpot()">Generate Jackpot (2000 VOI)</button>
    
    <div id="output"></div>

    <script>
        // Compact encoder for testing
        const SYMBOL_TO_DIGIT = {
            'A': '0', 'B': '1', 'C': '2', 'D': '3', '_': '4'
        };

        function compressOutcome(outcome) {
            let compressed = '';
            for (const reel of outcome) {
                for (const symbol of reel) {
                    compressed += SYMBOL_TO_DIGIT[symbol] || '4';
                }
            }
            return compressed;
        }

        function generateHash(data) {
            let hash = 0;
            for (let i = 0; i < data.length; i++) {
                const char = data.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(36).substring(0, 4);
        }
        
        function encodeReplayData(spin) {
            // Compress the outcome grid (15 chars)
            const compressedOutcome = compressOutcome(spin.outcome);
            
            // Convert values to base36 for compression
            const winningsVOI = Math.floor(spin.winnings / 1000000); // Convert to VOI
            const betVOI = Math.floor(spin.totalBet / 1000000); // Convert to VOI
            const timestampHours = Math.floor(spin.timestamp / 3600000); // Convert to hours
            
            // Build compact string (using . as delimiter)
            const parts = [
                compressedOutcome,                    // 15 chars
                winningsVOI.toString(36),            // 1-3 chars typically
                betVOI.toString(36),                  // 1-2 chars typically
                spin.selectedPaylines.toString(36),   // 1 char (max 25 -> 'p')
                timestampHours.toString(36)           // 6-7 chars
            ];
            
            const dataString = parts.join('.');
            const hash = generateHash(dataString);
            
            // Final format: data.hash
            return `${dataString}.${hash}`;
        }

        function generateTestLink(scenario, spin) {
            const encoded = encodeReplayData(spin);
            const url = `http://localhost:5173/replay?d=${encoded}`;
            
            document.getElementById('output').innerHTML = `
                <h3>${scenario}</h3>
                <p><strong>Spin Data:</strong></p>
                <pre>${JSON.stringify(spin, null, 2)}</pre>
                <p><strong>Generated Link:</strong></p>
                <p>
                    <a href="${url}" target="_blank" class="test-link">${url}</a>
                    <button class="copy-btn" onclick="navigator.clipboard.writeText('${url}')">Copy</button>
                </p>
                <p class="test-description">Click the link to test the replay in a new tab</p>
            `;
        }

        function generateBigWin() {
            const spin = {
                outcome: [
                    ['B', 'B', 'B'],
                    ['B', 'B', 'B'],
                    ['B', 'B', 'B'],
                    ['B', 'B', 'B'],
                    ['B', 'B', 'B']
                ],
                winnings: 500000000, // 500 VOI in atomic units
                totalBet: 25000000, // 25 VOI in atomic units
                selectedPaylines: 25,
                timestamp: Date.now()
            };
            generateTestLink('Big Win Scenario (500 VOI)', spin);
        }

        function generateSmallWin() {
            const spin = {
                outcome: [
                    ['B', '_', 'C'],
                    ['B', 'B', 'B'],
                    ['_', 'C', '_'],
                    ['C', '_', 'C'],
                    ['_', 'B', 'C']
                ],
                winnings: 25000000, // 25 VOI in atomic units
                totalBet: 5000000, // 5 VOI in atomic units
                selectedPaylines: 10,
                timestamp: Date.now()
            };
            generateTestLink('Small Win Scenario (25 VOI)', spin);
        }

        function generateLoss() {
            const spin = {
                outcome: [
                    ['_', 'C', 'B'],
                    ['C', '_', 'C'],
                    ['B', 'C', '_'],
                    ['_', 'B', 'C'],
                    ['C', '_', 'B']
                ],
                winnings: 0,
                totalBet: 10000000, // 10 VOI in atomic units
                selectedPaylines: 20,
                timestamp: Date.now()
            };
            generateTestLink('Loss Scenario', spin);
        }

        function generateJackpot() {
            const spin = {
                outcome: [
                    ['A', 'A', 'A'],
                    ['A', 'A', 'A'],
                    ['A', 'A', 'A'],
                    ['A', 'A', 'A'],
                    ['A', 'A', 'A']
                ],
                winnings: 2000000000, // 2000 VOI in atomic units
                totalBet: 50000000, // 50 VOI in atomic units
                selectedPaylines: 25,
                timestamp: Date.now()
            };
            generateTestLink('Jackpot Scenario (2000 VOI)', spin);
        }

        // Generate a default big win on load
        generateBigWin();
    </script>
</body>
</html>